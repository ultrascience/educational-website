{"version":3,"file":"react-final-form-hooks.umd.js","sources":["../src/useField.js","../src/useFormState.js","../src/internal/shallowEqual.js","../src/useForm.js"],"sourcesContent":["import { fieldSubscriptionItems } from 'final-form'\nimport { useEffect, useRef, useState } from 'react'\n\nexport const all = fieldSubscriptionItems.reduce((result, key) => {\n  result[key] = true\n  return result\n}, {})\n\nconst subscriptionToInputs = subscription =>\n  fieldSubscriptionItems.map(key => Boolean(subscription[key]))\n\nconst eventValue = event => {\n  if (!event || !event.target) {\n    return event\n  } else if (event.target.type === 'checkbox') {\n    return event.target.checked\n  }\n\n  return event.target.value\n}\n\nconst useField = (name, form, validate, subscription = all) => {\n  const autoFocus = useRef(false)\n  const validatorRef = useRef(undefined)\n  const [state, setState] = useState({})\n\n  validatorRef.current = validate\n\n  const deps = subscriptionToInputs(subscription)\n  useEffect(\n    () =>\n      form.registerField(\n        name,\n        newState => {\n          if (autoFocus.current) {\n            autoFocus.current = false\n            setTimeout(() => newState.focus())\n          }\n          setState(newState)\n        },\n        subscription,\n        validate\n          ? {\n              getValidator: () => validatorRef.current\n            }\n          : undefined\n      ),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [name, form, ...deps]\n  )\n  let { blur, change, focus, value, ...meta } = state\n  delete meta.name // it's in input\n  return {\n    input: {\n      name,\n      value: value === undefined ? '' : value,\n      onBlur: () => state.blur(),\n      onChange: event => state.change(eventValue(event)),\n      onFocus: () => {\n        if (state.focus) {\n          state.focus()\n        } else {\n          autoFocus.current = true\n        }\n      }\n    },\n    meta\n  }\n}\n\nexport default useField\n","import { useEffect, useState } from 'react'\nimport { formSubscriptionItems } from 'final-form'\n\nexport const all = formSubscriptionItems.reduce((result, key) => {\n  result[key] = true\n  return result\n}, {})\n\n/**\n * Converts { active: true, data: false, ... } to `[true, false, false, ...]`.\n */\nconst subscriptionToInputs = subscription =>\n  formSubscriptionItems.map(key => Boolean(subscription[key]))\n\nconst useFormState = (form, subscription = all) => {\n  const [state, setState] = useState(() => form.getState())\n\n  const deps = subscriptionToInputs(subscription)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => form.subscribe(setState, subscription), [form, ...deps])\n\n  return state\n}\n\nexport default useFormState\n","const shallowEqual = (a, b) => {\n  if (a === b) {\n    return true\n  }\n  if (typeof a !== 'object' || !a || typeof b !== 'object' || !b) {\n    return false\n  }\n  const keysA = Object.keys(a)\n  const keysB = Object.keys(b)\n  if (keysA.length !== keysB.length) {\n    return false\n  }\n  const bHasOwnProperty = Object.prototype.hasOwnProperty.bind(b)\n  for (let idx = 0; idx < keysA.length; idx++) {\n    const key = keysA[idx]\n    if (!bHasOwnProperty(key) || a[key] !== b[key]) {\n      return false\n    }\n  }\n  return true\n}\n\nexport default shallowEqual\n","import { useCallback, useRef, useEffect } from 'react'\nimport { createForm, configOptions } from 'final-form'\nimport useFormState from './useFormState'\nimport shallowEqual from './internal/shallowEqual'\n\n// https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\nconst useMemoOnce = factory => {\n  const ref = useRef()\n\n  if (!ref.current) {\n    ref.current = factory()\n  }\n\n  return ref.current\n}\n\nconst useForm = ({\n  subscription,\n  initialValuesEqual = shallowEqual,\n  ...config\n}) => {\n  const form = useMemoOnce(() => createForm(config))\n  const prevConfig = useRef(config)\n  const state = useFormState(form, subscription)\n  const handleSubmit = useCallback(\n    event => {\n      if (event) {\n        if (typeof event.preventDefault === 'function') {\n          event.preventDefault()\n        }\n        if (typeof event.stopPropagation === 'function') {\n          event.stopPropagation()\n        }\n      }\n      return form.submit()\n    },\n    [form]\n  )\n\n  useEffect(() => {\n    if (config === prevConfig.current) {\n      return\n    }\n\n    if (\n      config.initialValues &&\n      !initialValuesEqual(\n        config.initialValues,\n        prevConfig.current.initialValues\n      )\n    ) {\n      form.initialize(config.initialValues)\n    }\n\n    configOptions.forEach(key => {\n      if (key !== 'initialValues' && config[key] !== prevConfig.current[key]) {\n        form.setConfig(key, config[key])\n      }\n    })\n\n    prevConfig.current = config\n  })\n\n  return { ...state, form, handleSubmit }\n}\n\nexport default useForm\n"],"names":["all","fieldSubscriptionItems","reduce","result","key","subscriptionToInputs","subscription","map","Boolean","eventValue","event","target","type","checked","value","useField","name","form","validate","autoFocus","useRef","validatorRef","undefined","useState","state","setState","current","deps","useEffect","registerField","newState","setTimeout","focus","getValidator","blur","change","meta","input","onBlur","onChange","onFocus","formSubscriptionItems","useFormState","getState","subscribe","shallowEqual","a","b","keysA","Object","keys","keysB","length","bHasOwnProperty","prototype","hasOwnProperty","bind","idx","useMemoOnce","factory","ref","useForm","initialValuesEqual","config","createForm","prevConfig","handleSubmit","useCallback","preventDefault","stopPropagation","submit","initialValues","initialize","configOptions","forEach","setConfig"],"mappings":"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"}