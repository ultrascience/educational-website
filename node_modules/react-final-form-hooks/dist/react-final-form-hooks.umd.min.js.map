{"version":3,"file":"react-final-form-hooks.umd.min.js","sources":["../src/useFormState.js","../src/internal/shallowEqual.js","../src/useField.js","../src/useForm.js"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { formSubscriptionItems } from 'final-form'\n\nexport const all = formSubscriptionItems.reduce((result, key) => {\n  result[key] = true\n  return result\n}, {})\n\n/**\n * Converts { active: true, data: false, ... } to `[true, false, false, ...]`.\n */\nconst subscriptionToInputs = subscription =>\n  formSubscriptionItems.map(key => Boolean(subscription[key]))\n\nconst useFormState = (form, subscription = all) => {\n  const [state, setState] = useState(() => form.getState())\n\n  const deps = subscriptionToInputs(subscription)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => form.subscribe(setState, subscription), [form, ...deps])\n\n  return state\n}\n\nexport default useFormState\n","const shallowEqual = (a, b) => {\n  if (a === b) {\n    return true\n  }\n  if (typeof a !== 'object' || !a || typeof b !== 'object' || !b) {\n    return false\n  }\n  const keysA = Object.keys(a)\n  const keysB = Object.keys(b)\n  if (keysA.length !== keysB.length) {\n    return false\n  }\n  const bHasOwnProperty = Object.prototype.hasOwnProperty.bind(b)\n  for (let idx = 0; idx < keysA.length; idx++) {\n    const key = keysA[idx]\n    if (!bHasOwnProperty(key) || a[key] !== b[key]) {\n      return false\n    }\n  }\n  return true\n}\n\nexport default shallowEqual\n","import { fieldSubscriptionItems } from 'final-form'\nimport { useEffect, useRef, useState } from 'react'\n\nexport const all = fieldSubscriptionItems.reduce((result, key) => {\n  result[key] = true\n  return result\n}, {})\n\nconst subscriptionToInputs = subscription =>\n  fieldSubscriptionItems.map(key => Boolean(subscription[key]))\n\nconst eventValue = event => {\n  if (!event || !event.target) {\n    return event\n  } else if (event.target.type === 'checkbox') {\n    return event.target.checked\n  }\n\n  return event.target.value\n}\n\nconst useField = (name, form, validate, subscription = all) => {\n  const autoFocus = useRef(false)\n  const validatorRef = useRef(undefined)\n  const [state, setState] = useState({})\n\n  validatorRef.current = validate\n\n  const deps = subscriptionToInputs(subscription)\n  useEffect(\n    () =>\n      form.registerField(\n        name,\n        newState => {\n          if (autoFocus.current) {\n            autoFocus.current = false\n            setTimeout(() => newState.focus())\n          }\n          setState(newState)\n        },\n        subscription,\n        validate\n          ? {\n              getValidator: () => validatorRef.current\n            }\n          : undefined\n      ),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [name, form, ...deps]\n  )\n  let { blur, change, focus, value, ...meta } = state\n  delete meta.name // it's in input\n  return {\n    input: {\n      name,\n      value: value === undefined ? '' : value,\n      onBlur: () => state.blur(),\n      onChange: event => state.change(eventValue(event)),\n      onFocus: () => {\n        if (state.focus) {\n          state.focus()\n        } else {\n          autoFocus.current = true\n        }\n      }\n    },\n    meta\n  }\n}\n\nexport default useField\n","import { useCallback, useRef, useEffect } from 'react'\nimport { createForm, configOptions } from 'final-form'\nimport useFormState from './useFormState'\nimport shallowEqual from './internal/shallowEqual'\n\n// https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\nconst useMemoOnce = factory => {\n  const ref = useRef()\n\n  if (!ref.current) {\n    ref.current = factory()\n  }\n\n  return ref.current\n}\n\nconst useForm = ({\n  subscription,\n  initialValuesEqual = shallowEqual,\n  ...config\n}) => {\n  const form = useMemoOnce(() => createForm(config))\n  const prevConfig = useRef(config)\n  const state = useFormState(form, subscription)\n  const handleSubmit = useCallback(\n    event => {\n      if (event) {\n        if (typeof event.preventDefault === 'function') {\n          event.preventDefault()\n        }\n        if (typeof event.stopPropagation === 'function') {\n          event.stopPropagation()\n        }\n      }\n      return form.submit()\n    },\n    [form]\n  )\n\n  useEffect(() => {\n    if (config === prevConfig.current) {\n      return\n    }\n\n    if (\n      config.initialValues &&\n      !initialValuesEqual(\n        config.initialValues,\n        prevConfig.current.initialValues\n      )\n    ) {\n      form.initialize(config.initialValues)\n    }\n\n    configOptions.forEach(key => {\n      if (key !== 'initialValues' && config[key] !== prevConfig.current[key]) {\n        form.setConfig(key, config[key])\n      }\n    })\n\n    prevConfig.current = config\n  })\n\n  return { ...state, form, handleSubmit }\n}\n\nexport default useForm\n"],"names":["useFormState","form","subscription","all","useState","getState","state","setState","deps","formSubscriptionItems","map","key","Boolean","subscriptionToInputs","useEffect","subscribe","shallowEqual","a","b","keysA","Object","keys","keysB","length","bHasOwnProperty","prototype","hasOwnProperty","bind","idx","fieldSubscriptionItems","reduce","result","name","validate","autoFocus","useRef","validatorRef","undefined","current","registerField","newState","setTimeout","focus","getValidator","blur","change","value","meta","input","onBlur","onChange","event","target","type","checked","eventValue","onFocus","initialValuesEqual","config","factory","ref","useMemoOnce","createForm","prevConfig","handleSubmit","useCallback","preventDefault","stopPropagation","submit","initialValues","initialize","configOptions","forEach","setConfig"],"mappings":"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"}